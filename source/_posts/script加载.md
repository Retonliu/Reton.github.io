---
title: script加载
date: 2020-11-14 09:20
tags:
- javascript
---

在script加载的时候，有通过给script添加属性或者动态添加script标签等特殊情况。通过本文记录一下。

* script标签不加defer属性或者async属性的时候，浏览器会立即加载并 执行脚本文件，停止渲染页面。所以会导致页面出现停滞现象。

* defer属性表示在解析的时候遇到当前script标签先加载，然后等页面全部渲染完成之后才开始执行这个脚本文件。**HTML5规范脚本应该按照它们在HTML中出现的顺序执行。所以第一个defer的脚本会在第二个defer的脚本之前执行。而且这两者都会在DOMContentLoaded事件之前执行。**不过在实际开发当中，以上的情况不一定能保证发生。所以在实际的开发当中，最好还是将script放在页面底部比较好，防止以上情况没有发生。

* async async也是先加载，但是**在加载的时候，页面继续渲染，等到async的脚本加载完成立即执行**。然后但是不一样的是**async的脚本不保证按照它们出现的次序执行**

* 动态加载脚本文件。例如通过在别的脚本文件当中创建一个script的元素，然后为这个元素指定src，在把这个script元素添加到HTML文档当中。默认情况下，动态加载的脚本文件是相当于添加了async属性。但是最好的做法是把给动态生成的脚本设置为同步加载 *script.async = false;*，这样可以避免可能出现的问题，比如浏览器没有实现async属等情况。 **以动态方式加载的脚本文件，对于浏览器的预加载器来说是不可见的。这会影响到脚本文件在资源获取队列中的优先级。以及影响到程序的性能。所以为了让预加载器知道这些动态脚本文件的存在，可以在文档的头部显示声明它们&lt;link rel="preload" href="xxxx.js"&gt;(类似于声明css文件一样)**