---
title: 计算机网络复习笔记
date: 2021-01-17 10:08
tags:
- 计算机网络
---
# 概述  
1. 应用层——应用层的任务是通过应用进程间的交互，完成特定网络应用。

2. 运输层——运输层的任务是负责两台主机进程间的通信，提供连通的数据传输服务。运输层主要使用以下两种传输写协议：传输控制协议TCP，用户数据报文协议UDP。

3. 网络层——网络层负责为分组交换网上的不同主机提供通信服务，在发送数据时，网络层把运输层产生的报文段或用户数据包分组进行传送。网络层的另一个任务就是要选择合适的路由，使源主机运输层所传输的下来的分组能够通过网络中的路由器，找到目的主机。

4. 数据链路层——数据链路层简称为链路层，两台主机的数据传输总是在一段一段的链路上传送的，这就要使用专门的链路层协议，在两个相邻节点传送数据时，数据链路层将网络层交下来的IP数据报组装成帧，在两个相邻节点的链路上传送帧。

5. 物理层——物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是要尽可能地屏蔽掉不同传输媒体和通信手段的差异。  


# 网络安全
## 安全威胁
![](1.png)
如图,被动攻击和主动攻击的主要区别就在于,目的站最终有没有收到本应收到的信息
### 1. 被动攻击  
+ 区分:目的站可以收到源站的信息,攻击者没有干扰信息流  
+ 截获/流量分析: 指攻击者从网络上窃听他人的通信内容。在被动攻击中，攻击者只是观察和分析某一个协议数据单元 PDU，以便了解所交换的数据的某种性质。但不干扰信息流。  
+ 应对方法： 数据加密  

### 2. 主动攻击  
+ 区分: 目的站收到的不是源站的信息  
+ 分类：  

    1. 篡改————故意篡改网络上传送的报文。这种攻击方式有时也称为更改报文流
    2. 恶意程序————种类繁多，对网络安全威胁较大的主要包括：计算机病毒、计算机蠕虫、特洛伊木马、逻辑炸弹、后门入侵、流氓软件等。
    3. 拒绝服务————指攻击者向互联网上的某个服务器不停地发送大量分组，使该服务器无法提供正常服务，甚至完全瘫痪。    
+ 应对方法： 加密技术与适当的鉴别技术相结合

## 密钥体制  
### 1.对称密钥  
一对一通道
加密密钥与解密密钥是相同的密码体制。加密和解密双方共享密钥  
### 2. 公钥私钥  
多对一通道
使用不同的加密密钥与解密密钥。  
+ 公钥密码体制出现的原因：  
    1. 常规密钥密码体制的密钥分配问题。（不用存储那么多）  
    2. 对数字签名的需求   
+ 加密密钥： 向公众公开的  
+ 解密密钥： 需要保密的  
*私钥 SK 是由公钥PK 决定的，但却不能根据 PK 计算出 SK*
### 3. 数字签名  
与公钥密码相反，公钥密码使用公开的密钥加密，私有密钥解密。  
数字签名使用公开密钥解密，私有密钥加密。  
## 防火墙  
+ 定义：防火墙是由软件、硬件构成的系统，是一种特殊编程的路由器，用来在两个网络之间实施访问控制策略
+ 可信网络： 防火墙内的网络
+ 不可信网络： 防火墙外的网络  
+ 功能：  
    1. 阻止（主要功能）：就是阻止某种类型的通信量通过防火墙
    2. 允许    
+ 实现防火墙的技术：
    1. 分组过滤路由器： 根据过滤规则对进出内部网络的分组执行转发或者丢弃（即过滤）。过滤规则基于分组的**网络层**或**运输层**首部的信息。  
    2. 应用网关/代理服务器  
    在应用层通信中扮演报文中继的角色，可以实现基于应用层数据的过滤和高层用户鉴别  

# 应用层  
## DNS
+ DNS 域名服务器都把数据复制到几个域名服务器来保存，其中的一个是主域名服务器，其他的是辅助域名服务器
+ 当主域名服务器出故障时，辅助域名服务器可以保证 DNS 的查询工作不会中断  

### 根域名服务器
+ 定义：最高层次的域名服务器，也是最重要的域名服务器
*在互联网上共有 13 个不同 IP 地址的根域名服务器，它们的名字是用一个英文字母命名，从 a  一直到 m。根域名服务器共有 13 套装置，不是 13 个机器*
### 顶级服务器（Top Level Domain）TLD
负责管理在该顶级域名服务器注册的所有二级域名
### 权限域名服务器
+ 负责一个区的域名服务器
+ 当一个权限域名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的 DNS 客户，下一步应当找哪一个权限域名服务器。    

### 本地域名服务器
+ 当一个主机发出 DNS 查询请求时，这个查询请求报文就发送给本地域名服务器
+ 每一个互联网服务提供者 ISP，或一个大学，甚至一个大学里的系，都可以拥有一个本地域名服务器

### 递归查询  
![](dfs.png)
主机向本地域名服务器的查询一般都是采用递归查询。如果主机所询问的本地域名服务器不知道被查询域名的 IP 地址，那么本地域名服务器就以 DNS 客户的身份，向其他根域名服务器继续发出查询请求报文。  
### 迭代查询   
![](ite.png)
本地域名服务器向根域名服务器的查询通常是采用迭代查询。当根域名服务器收到本地域名服务器的迭代查询请求报文时，要么给出所要查询的 IP 地址，要么告诉本地域名服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地域名服务器进行后续的查询。  
### 域名服务器缓存
+ 每个域名服务器都维护一个高速缓存，存放最近用过的名字以及从何处获得名字映射信息的记录  
+ 域名服务器为每项内容设置计时器保持高速缓存中的内容正确  
+ 减轻服务器负荷，使互联网上的DNS查询和回应报文数量减少  
## FTP
+ 定义：文件传送协议，提供文件传送的一些基本的服务
+ 减少或消除在不同操作系统下处理文件的不兼容性
+ 使用 TCP 可靠的运输服务。
+ 使用客户服务器方式，服务器进程由两大部分组成：一个主进程，负责接受新的请求；另外有若干个从属进程，负责处理单个请求
+ 使用了两个TCP连接，在服务器端：一个连接用于控制进程（主进程）端口号为21又称熟知端口，一个连接用于数据运输进程（从进程，处理请求并发送/处理数据）端口号为20  
*ps: NFS（Network File System） 允许应用进程打开一个远地文件，并能在该文件的某一个特定的位置上开始读写数据,NFS主要还是用于分布式存储问题中*  
## Telnet  
简单的远程终端协议,TELNET 能将用户的击键传到远地主机，同时也能将远地主机的输出通过 TCP 连接返回到用户屏幕。这种服务是透明的，因为用户感觉到好像键盘和显示器是直接连在远地主机上  
+ 客户服务器模式，类似FTP  

## 万维网  
**理解：其实这是一个概念性的东西，即平时浏览器和服务器交接这些方式就可以认为是在万维网上运行的。定义了浏览器就是客户，服务器就是存放了各种资源的计算机。即虽然有ip地址用于表示每一台计算机在互联网中的位置，但是对于每一台计算机上的每一种资源如图片、文档等，都需要标识，因为客户要的就是服务器上的某个物品，还有如何处理服务器要向客户展示自己的信息等，这就是万维网的意义，把这些体验的问题都解决了。万维网是基于HTTP的，所以对用户封装了底部的HTTP访问细节，用户只需要知道目标地址的域名即可访问目标页面。也即帮用户把复杂的细节封装了，用户看到的就是几个简单的链接。**
+ 定义：并非某种特殊的计算机网络,而是一个大规模的、联机式的信息储藏所  
+ 客户-服务器方式工作  
+ 浏览器就是在用户计算机上的万维网客户程序。万维网文档所驻留的计算机则运行服务器程序，因此这个计算机也称为万维网服务器。
+ （重点）万维网寻找某一个资源：统一资源定位符URL，标志万维网上的各种文档。例如一个html页面或者一张图片在万维网上应该在哪里。www.retonliu.html，这就是retonliu的html文件标识符。  
+ （重点）在万维网客户程序与万维网服务器程序之间进行交互所使用的协议，是超文本传送协议 HTTP ,**理解：万维网是建立在HTTP协议之上的**  
+ （重点）万维网显示页面: HTML（超文本标记语言 ），使得万维网页面的设计者可以很方便地用一个超链从本页面的某处链接到互联网上的任何一个万维网页面，并且能够在自己的计算机屏幕上将这些页面显示出来。  
+ 搜索引擎： 为了在万维网上方便地查找信息，用户可使用各种的搜索工具  

## HTTP  
+ 定义：面向事务的 (transaction-oriented) 应用层协议，它是万维网上能够可靠地交换文件（包括文本、声音、图像等各种多媒体文件）的重要基础  
+ 使用了面向连接的 TCP 作为运输层协议  
+ 是面向事务的客户服务器协议  
+ HTTP 1.0 协议是无状态的 (stateless)——每次访问是一样的
+ HTTP/1.1 协议使用持续连接

### cookie
在 HTTP 服务器和客户之间传递的状态信息。
使用 Cookie 的网站服务器为用户产生一个唯一的识别码。利用此识别码，网站就能够跟踪该用户在该网站的活动。

### XML
设计宗旨是传输数据，而不是显示数据

## 邮件协议
### SMTP  
![](smtp.png)
基于TCP,端口号为25
简单邮件发送协议 SMTP（Simple Mail Transfer Protocol ）：用于在用户代理向邮件服务器或邮件服务器之间发送邮件。  
1. SMTP 规定了在两个相互通信的 SMTP 进程交换信息的方法。
2. SMTP 使用客户–服务器方式。
3. SMTP 基于 TCP 实现客户与服务器的通信  
4. MIME是对SMTP的拓展，使得客户可以在邮件中传送文件和图片等

### POP3 
基于TCP 
邮局协议 POP3（Post Office Protocol）：用于用户代理从邮件服务器读取邮件  
### IMAP
网际报文存取协议，用户从目的邮件服务器上读取邮件所使用的协议。  
**IMAP的部分操作是客户端与邮箱更新同步，而PO3是仅在客户端内**  

## DHCP
在协议软件中，给协议参数赋值的动作叫做协议配置。互联网广泛使用的动态主机配置协议 DHCP提供了即插即用连网。这种机制允许一台计算机加入新的网络和获取 IP 地址，而不用手工配置（手机加入一个新地区的网络，请求IP地址）
1. DHCP给：
    1. 运行服务器软件、且位置固定的计算机指派一个永久地址。
    2. 给运行客户端软件的计算机分配一个临时地址  
2. 客户-服务器方式，请求/应答方式
3. 基于UDP工作，服务器运行在67号端口，客户运行在68号端口

## SNMP
网管
+ UDP
+ 用 get 报文来检测各被管对象的状况  
+ 用 set 报文来改变各被管对象的状况  
+ （轮询）探询操作 —— SNMP 管理进程定时向被管理设备周期性地发送探询信息  
+ 同时也采用陷阱机制（不经过询问就能发送某些信息）报告特殊事件，使得 SNMP 成为一种有效的网络管理协议  

## P2P
解决了集中式媒体服务器可能出现的瓶颈问题  
+ 洪流： 所有对等方集合  
+ 文件快： 下载文件的数据单元为长度固定的文件快
+ TCP  
+ 下载：从互联网到主机  
+ 上传： 主机到互联网  

### BT协议  
问：哪些文件块是首先需要向其相邻对等方请求的？
>A使用最稀有的优先 (rarest first) 的技术，首先向其相邻对等方请求对应的文件块。
所谓稀有是指：如果A所缺少的文件块在相邻对等方中的副本很少，那就是“很稀有的”

问：在很多向A请求文件块的相邻对等方中，A应当向哪些相邻对等方发送所请求的文件块？  
>凡当前以最高数据率向 A 传送文件块的某相邻对等方，A 就优先把所请求的文件块传送给该相邻对等方  

  
## 套接字
![](socket.png)
+ socket  
+ send发送，recv接收    


# 运输层
+ 主机A和主机B进行通信”实际上是指：“运行在主机A上的某个程序和运行在主机B上的另一个程序进行通信”。端到端的通信是进程之间的通信。
+ TCP和UCP的区别
![](tcpudp.png)
![](tcpudp2.png)  

## TCP传输控制协议  
TCP的特点：
+ TCP 是面向连接的运输层协议。
+ 每一条 TCP 连接只能有两个端点 (endpoint)，每一条 TCP 连接只能是点对点的（一对一），不能进行多播和广播（一对多）
+ TCP 提供可靠交付的服务（无差错、不丢失、不重复并且按序到达）。
+ TCP 提供全双工通信。
+ 面向字节流
    + “面向字节流”的含义是：虽然应用程序和 TCP 的交互是一次一个数据块，但 TCP 把应用程序交下来的数据看成仅仅是一连串无结构的字节流
    + TCP 不保证接收方应用程序所收到的数据块和发送方应用程序所发出的数据块具有对应大小的关系。
    + 但接收方应用程序收到的字节流必须和发送方应用程序发出的字节流完全一样。
+ TCP 连接的端点不是主机，不是主机的IP 地址，不是应用进程，也不是运输层的协议端口。TCP 连接的端点叫做套接字 (socket) 。  
+ 虽然面向的是字节流，但是传送的是报文段  

### TCP连接的三个阶段  
1. 连接建立
2. 数据传送
3. 连接释放

### 停等协议  
![](tingdeng.png)
### ARQ协议  
+ 滑动窗口：
    发送方维持的发送窗口，它的意义是：位于发送窗口内的分组都可连续发送出去，而不需要等待对方的确认。这样，信道利用率就提高了  
+ TCP 连接的每一端都必须设有两个窗口——一个发送窗口和一个接收窗口  
+ TCP 的可靠传输机制用字节的序号进行控制  
+ 超时重传：计时器实现  

### 累计确认  
![](leiji.png)  
接收方一般采用累积确认的方式。即不必对收到的分组逐个发送确认，而是对按序到达的最后一个分组发送确认，这样就表示：到这个分组为止的所有分组都已正确收到了  
### 回退N  
如果发送方发送了前 5 个分组，而中间的第 3 个分组丢失了。这时接收方只能对前两个分组发出确认。发送方无法知道后面三个分组的下落，而只好把后面的三个分组都再重传一次。

### TCP报文段首部重要部分  
1. 紧急 URG —— 当 URG=1 时，表明紧急指针字段有效。它告诉系统此报文段中有紧急数据，应尽快传送(相当于高优先级的数据)。   
2. 确认 ACK —— 只有当 ACK =1 时确认号字段才有效。当 ACK =0 时，确认号无效。   
3. 推送 PSH (PuSH) —— 接收 TCP 收到 PSH = 1 的报文段，就尽快地交付接收应用进程，而不再等到整个缓存都填满了后再向上交付  
4. 复位 RST (ReSeT) —— 当 RST=1 时，表明 TCP 连接中出现严重差错（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立运输连接。 
5. 同步 SYN —— 同步 SYN = 1 表示这是一个连接请求或连接接受报文。 
6. 终止 FIN (FINish) —— 用来释放一个连接。FIN=1 表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。 

### TCP 流量控制  
简单来说就是让发送方知道接收方还能接收多少字节的数据,发送方维持一个接收窗口，rwnd来得知接收方的情况。防止缓存溢出。  
### TCP 拥塞控制（重点）  
1. TCP 采用基于窗口的方法进行拥塞控制。该方法属于闭环控制方法。
2. TCP发送方维持一个拥塞窗口 cwnd (Congestion Window)
3. 发送端利用拥塞窗口根据网络的拥塞情况调整发送的数据量。
4. 发送窗口大小不仅取决于接收方窗口，还取决于网络的拥塞状况，所以真正的发送窗口值为
综合了流量控制和拥塞控制： 真正的发送窗口值 = Min (接收方窗口值，拥塞窗口值)  

### TCP拥塞控制算法（重点） 
![](yongsekongzhi.png) 
#### 慢开始 (slow-start)  
+ 发送方每收到一个对新报文段的确认（重传的不算在内）就使 cwnd 加 1。 
+ 每经过一个传输轮次，拥塞窗口就加倍，因为下一次发送的报文段数目会加倍
+ 窗口大小按指数增加，不慢！
+ 只要发送方判断网络出现拥塞（重传定时器超时）：
    1. ssthresh = max (cwnd/2，2)
    2. cwnd = 1
    3. 执行慢开始算法  

#### 拥塞避免 (congestion avoidance)  
+ 在超时之前，每经过一个传输轮次就使 cwnd 加 1  
+ 只要发送方判断网络出现拥塞（重传定时器超时）：
    1. ssthresh = max (cwnd/2，2)
    2. cwnd = 1
    3. 执行慢开始算法

#### 快重传 (fast retransmit)  
发送方只要一连收到三个重复确认，就知道接收方确实没有收到报文段，因而应当立即进行重传（即“快重传”），这样就不会出现超时，发送方也不就会误认为出现了网络拥塞。

#### 快恢复 (fast recovery)  
当发送端收到连续三个重复的确认时，由于发送方现在认为网络很可能没有发生拥塞，因此现在不执行慢开始算法，而是执行快恢复算法 FR (Fast Recovery) 算法：
![](yongse.png)
1. 慢开始门限 ssthresh = 当前拥塞窗口 cwnd / 2 ；
2. 新拥塞窗口 cwnd = 慢开始门限 ssthresh ；
3. 开始执行拥塞避免算法，使拥塞窗口缓慢地线性增大。 


## UDP 用户数据报协议  
UDP 只在 IP 的数据报服务之上增加了很少一点的功能(加强版的IP)：  
    1. 运输层协议复用和分用的功能
    2. 差错检测的功能  
UDP的特点：  
1. UDP 是无连接的，发送数据之前不需要建立连接，减少时延
2. UDP 使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的连接状态表。  
3. UDP 是面向报文的。UDP 对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。UDP 一次交付一个完整的报文。即应用层交给 UDP 多长的报文，UDP 就照样发送。  
4. UDP 没有拥塞控制  
5. UDP 支持一对一、一对多、多对一和多对多的交互通信  
6. UDP 的首部开销小  

# 网络层
![](wangluocengbijiao.png)  
## IP协议（网际协议）  
**理解：IP是抽象出来的，虚拟的。实际中的传播仍然是链路层中的根据硬件之间的传播，但是硬件之间太过于复杂，引入ip把这个过程给抽象出来，简单化了。**
IP协议所要解决的问题：  
1. 不同的寻址方案 
2. 不同的最大分组长度 
3. 不同的网络接入机制 
4. 不同的超时控制 
5. 不同的路由选择技术 
6. 不同的服务（面向连接服务和无连接服务） 
7. 不同的管理与控制方式等     

### 关于IP地址：  
+ 是一种逻辑地址，因为由软件实现的
+ ABC类，特殊IP地址
+ 在同一个局域网上的 主机或路由器的 IP 地址中的网络号必 须是一样的  
  
### IP报文首部  
+ 总长度——占 16 位，指**首部和数据之和的长度**， 单位为字节，因此数据报的最大长度为65535 字节。 总长度必须不超过最大传送单元MTU  
+ 首部检验和——占16 位，只检验数据报的首部， 不检验数据部分。这里不采用CRC 检验码而采用简单的计算方法  
+ 标志字段的最低位是 MF (More Fragment)。 MF=1 表示后面“还有分片”。MF=0 表示最后一个分片。 标志字段中间的一位是 DF (Don't Fragment) 。 只有当 DF=0 时才允许分片。  


### ARP协议  （重点）  
地址解析协议ARP，用于根据机器的IP地址求出其对应的硬件地址  
+ 不管网络层使用的是什么协议，在实际网络的链路上传送数据帧时， 最终还是必须使用硬件地址。 
+ 每一个主机或路由器都设有一个 ARP 高速缓存 (ARP cache)，里面 有所在的局域网上的各主机和路由器的 IP 地址到硬件地址的映射表。（联系DNS）  
+ 格式：< IP address；MAC address；TTL > ，TTL地址映射有效时间  

#### ARP协议进行过程  
当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址（B的映射）。 
1. 如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧， 然后通过局域网将该 MAC 帧发往此硬件地址。 
2. 如没有， ARP 进程在本局域网上广播发送一个 ARP 请求分组。收 到 ARP 响应分组后，将得到的 IP 地址到硬件地址的映射写入 ARP 高速缓存。  
![](arp.png)  
3. ARP高速缓存，存放最近获得的 IP 地址到 MAC 地址的绑定，以减少 ARP 广播的数 量  
4.  ARP 用于解决**同一个局域网上**的主机或路由器的 IP 地址和硬件地址 的映射问题  
5. 如果所要找的主机和源主机不在同一个局域网上，那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送 给这个路由器，让这个路由器把分组转发给下一个网络。剩下的工作 就由下一个网络来做  
6. 从 IP 地址到硬件地址的解析是自动进行的，主机的用户对这种地址解 析过程是不知道的。   
7. 只要主机或路由器要和本网络上的另一个已知 IP 地址的主机或路由器 进行通信，ARP 协议就会自动地将该 IP 地址解析为链路层所需要的 硬件地址。  
### IP数据报分片  
*首部占20字节*
![](ipfenpian.png)
![](pianyi.png)  
### IP转发  （重点）
![](zhuanfa.png)  
+ 根据目的网络地址就能确定下一跳路由器，这样做的结果是： 
    1. IP 数据报最终一定可以找到目的主机所在目的网络上的路由器（可 能要通过多次的间接交付）。 
    2. 只有到达最后一个路由器时，才试图向目的主机进行直接交付




